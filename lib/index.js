!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("react"),require("immer"),require("lodash.sortby")):"function"==typeof define&&define.amd?define(["react","immer","lodash.sortby"],e):(t=t||self).MyRoot=e(t.React,t.produce,t.sortBy)}(this,(function(t,e,n){"use strict";var r="default"in t?t.default:t,a="default"in e?e.default:e;n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;var o=r.createContext({wizard:!1});function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function g(t,e,n){return(g=d()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var a=new(Function.bind.apply(t,r));return n&&f(a,n.prototype),a}).apply(null,arguments)}function p(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){a=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}return n}(t,e)||v(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||v(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){if(t){if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var P=function(){function t(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=o.validator,s=void 0!==i&&i,c=o.required,l=void 0!==c&&c,f=o.Input,d=void 0===f?null:f,g=o.state,p=void 0===g?{}:g;u(this,t),this[e.immerable]=!0,this._id=n,this.label=r,this.value=a,this.required=l,this.validator="function"==typeof s&&s,this.Input=d,this.state=p}return c(t,[{key:"id",get:function(){return this._id}},{key:"hasValidValue",get:function(){return this.validator?this.validator(this.value,this):!this.required||""!==this.value}},{key:"required",set:function(t){this._required=t},get:function(){return"function"==typeof this._required?this._required(this):this._required}}]),t}(),b=function(){function t(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=a.order,i=void 0===o?null:o,s=a.data,c=void 0===s?[]:s,l=a.parent,f=void 0===l?null:l,d=a.isComplete,g=void 0===d?null:d,p=a.canGoTo,h=void 0===p?null:p,y=a.View,v=void 0===y?null:y,m=a.state,P=void 0===m?{}:m;u(this,t),this[e.immerable]=!0,this._id=n,this.title=r,this.order=i,this.data=c,this.parent=f,this.isComplete=g,this.canGoTo=h,this.View=v,this.state=P}return c(t,[{key:"id",get:function(){return this._id}},{key:"data",set:function(t){if(Array.isArray(t)){var e=new Map;t.forEach((function(t){return e.set(t.id,t)})),this._data=e}t instanceof Map&&(this._data=t)},get:function(){return this._data||(this._data=new Map),this._data}},{key:"isComplete",get:function(){if(null!==this._isComplete)return"function"==typeof this._isComplete?this._isComplete(this):this._isComplete;var t=!0;return this.data.forEach((function(e){t&&(e.hasValidValue||(t=!1))})),t},set:function(t){this._isComplete=t}},{key:"canGoTo",get:function(){return"function"==typeof this._canGoTo?this._canGoTo(this):this._canGoTo},set:function(t){this._canGoTo=t}}]),t}();e.enableMapSet(),e.enableES5();var k={title:"wizard",pages:new Map,currentPageId:null,data:new Map},S="getPageState,setPageState,getDataState,setDataState,addPage,addPages,goNext,".concat("addPageData,goToPageId,goPrev,setPages,getDataValue,setDataValue".split(",")),_="pagesYouCanGoTo,firstPage,prevPage,nextPage,currentPage,pageList".split(","),w=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(v,t);var e,s,h=(e=v,s=d(),function(){var t,n=l(e);if(s){var r=l(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return p(this,t)});function v(t){var e;return u(this,v),(e=h.call(this,t)).state=a(k,(function(){})),e}return c(v,[{key:"addPageData",value:function(t){var e=this.pages.get(t);if(e){e=e.clone();for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var o=g(P,r);if(o.id){e.data.set(o.id,o);var i=this.pages;i.set(e.id,e),this.pages=i}}else console.log("cannot find a page",t)}},{key:"goToPageId",value:function(t,e){if(t){var n=this.state.currentPageId;t!==this.state.currentPageId&&(console.log("going to ",t,"from ",n),this.pages.has(t)?this.setState((function(e){return a(e,(function(e){e.currentPageId=t}))}),e):console.log("goToPageId: no id ",t))}}},{key:"goFirst",value:function(){var t=this.firstPage;t&&this.goToPageId(t.id)}},{key:"goNext",value:function(){var t=this.nextPage;t?this.goToPageId(t.id):console.log("cannot go to next page")}},{key:"goPrev",value:function(){var t=this.prevPage;t?this.goToPageId(t.id):console.log("cannot go to prev page")}},{key:"setPages",value:function(t,e){this.setState((function(e){return a(e,(function(e){e.pages=t}))}),e)}},{key:"getDataValue",value:function(t,e){var n=this.pages.get(t);if(!n)return null;var r=n.data.get(e);return r?r.value:null}},{key:"setDataValue",value:function(t,e,n,r){this.setState((function(r){return a(r,(function(r){var a=r.pages.get(t);if(!a)return r;var o=a.data.get(e);return o?(o.value=n,r):r}))}),r)}},{key:"_makePage",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e[0]instanceof b)return e[0];var r=g(b,e);if(r.id)return null===r.order&&(r.order=-1,this.pages.forEach((function(t){t.order>r.order&&(r.order=t.order)})),r.order+=1),r;console.log("cannot add page without id:",r)}},{key:"addPage",value:function(){for(var t=null,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];"function"==typeof n[n.length-1]&&(t=n.pop());var o=this._makePage.apply(this,n);this.setState((function(t){return a(t,(function(t){t.pages.set(o.id,o)}))}),t)}},{key:"addPages",value:function(t,e){var n=this,r=this.state;t.forEach((function(t){var e=n._makePage(t);r=a(r,(function(t){t.pages.set(e.id,e)}))})),this.setState(r,e)}},{key:"componentDidUpdate",value:function(){var t=this.state,e=t.pages;!t.currentPageId&&e.size&&this.goFirst(!0)}},{key:"updatePage",value:function(t,e,n){e?this.setState((function(n){return a(n,(function(n){var r=n.pages.get(t);r?"function"==typeof e?n.pages.set(t,e(r)):"object"===i(e)&&n.pages.set(t,Object.assign(r,e)):console.log("updatePage: no page ",t,e)}))}),n):console.log("updatePage: no update",t,e)}},{key:"getPageState",value:function(t,e){if(!t||!e)return console.log("getPageState requires pageId and stateName: given",t,e),null;var n=this.pages.get(t);return n?n.state[e]:(console.log("cannot find page ",t),null)}},{key:"setPageState",value:function(t,e,n,r){return t&&e?this.updatePage(t,(function(t){t.state[e]=n}),r):(console.log("setPageState requires pageId and stateName: given",t,e),null)}},{key:"getDataState",value:function(t,e,n){if(!e||!t||!n)return console.log("getDatatate requires pageId, dataId and stateName: given",t,e,n),null;var r=this.pages.get(t);if(r){var a=r.data.get(e);if(a)return a.state[n]}return console.log("cannot find page data",t,e),null}},{key:"setDatatate",value:function(t,e,n,r,a){return e&&t&&n?this.updatePage(t,(function(t){if(t){var a=t.data.get(e);a&&(a.state[n]=r)}}),a):(console.log("setDatatate requires pageId, dataId and stateName: given",t,e,n),null)}},{key:"render",value:function(){return r.createElement(o.Provider,{value:this.proxy},this.props.children)}},{key:"firstPage",get:function(){var t=null;return this.pages.forEach((function(e){console.log("first",t&&t.id,t&&t.order,"page: ",e.id,e.order),t?t.order>e.order&&(t=e):t=e})),t}},{key:"currentPage",get:function(){var t=this.state,e=t.pages,n=t.currentPageId;return n?e.get(n):null}},{key:"nextPage",get:function(){var t=this.currentPage;if(!t)return null;var e=null;return this.state.pages.forEach((function(n){!1!==n.canGoTo&&(n.order<=t.order||(!e||e.order>n.order)&&(e=n))})),e}},{key:"prevPage",get:function(){var t=this.currentPage;if(!t)return null;var e=null;return this.state.pages.forEach((function(n){!1!==n.canGoTo&&(n.order>=t.order||(!e||e.order<n.order)&&(e=n))})),e}},{key:"pages",get:function(){return this.state.pages},set:function(t){this.setPages(t)}},{key:"pageList",get:function(){var t=this.pages,e=[];return t.forEach((function(t){return e.push(t)})),n(e,"order","id")}},{key:"pagesYouCanGoTo",get:function(){for(var t=this.pageList.filter((function(t){return!1!==t.canGoTo})),e=new Set,r=0;t[r]&&t[r].isComplete;)e.add(t[r]),r+=1;return t[r]&&e.add(t[r]),t.forEach((function(t){!0===t.canGoTo&&e.add(t.canGoTo)})),n(y(e),"order")}},{key:"proxy",get:function(){var t=this;return"undefined"==typeof Proxy?(console.log("no proxy - returning immer"),a(this.state,(function(e){_.forEach((function(n){e[n]=t[n]})),S.forEach((function(n){e[n]=function(){return t[n].apply(t,arguments)}}))}))):new Proxy(this,{get:function(t,e){return e in t.state?t.state[e]:S.includes(e)?t[e].bind(t):_.includes(e)?t[e]:null},has:function(t,e){return e in t.state||_.includes(e)||S.includes(e)},set:function(t,e,n){e in t.state?t.setState((function(t){return t[e]=n})):console.log("attempt to set read-only property",e,"to",n)}})}}]),v}(t.Component);return{DataInput:function(e){var n=e.page,a=e.control,i=h(t.useState(a?a.value:""),2),u=i[0],s=i[1],c=t.useContext(o);if(t.useEffect((function(){var t=c.getFormValue(n.id,a.id);u!==t&&c.setFormValue(n.id,a.id,u)}),[u]),!n)return"";return r.createElement("input",{type:"text",value:u,onChange:function(t){s(t.target.value)}})},WizardContext:o,Wizard:w,Data:P,Page:b}}));
