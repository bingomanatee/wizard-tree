!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("react"),require("immer"),require("lodash.sortby"),require("lodash.flattendeep")):"function"==typeof define&&define.amd?define(["react","immer","lodash.sortby","lodash.flattendeep"],e):(t=t||self).MyRoot=e(t.React,t.produce,t.sortBy,t.lodash_flattendeep)}(this,(function(t,e,n,r){"use strict";var o="default"in t?t.default:t,a="default"in e?e.default:e;n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;var i=o.createContext({wizard:!1});function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),t}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){l(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function h(t,e,n){return(h=g()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&p(o,n.prototype),o}).apply(null,arguments)}function v(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,a=void 0;try{for(var i,u=t[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){o=!0,a=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}return n}(t,e)||b(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||b(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){if(t){if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var P=function(){function t(n,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=a.validator,c=void 0!==i&&i,f=a.required,l=void 0!==f&&f,s=a.Input,d=void 0===s?null:s,p=a.order,g=void 0===p?null:p,h=a.state,v=void 0===h?{}:h;u(this,t),this[e.immerable]=!0,this._id=n,this.label=r,this.order=g,this.value=o,this.required=l,this.validator="function"==typeof c&&c,this.Input=d,this.state=v}return f(t,[{key:"id",get:function(){return this._id}},{key:"hasValidValue",get:function(){return this.validator?this.validator(this.value,this):!this.required||""!==this.value}},{key:"required",set:function(t){this._required=t},get:function(){return"function"==typeof this._required?this._required(this):this._required}}]),t}(),O=function(){function t(n,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=o.order,i=void 0===a?null:a,c=o.data,f=void 0===c?[]:c,l=o.parent,s=void 0===l?null:l,d=o.isComplete,p=void 0===d?null:d,g=o.canGoTo,h=void 0===g?null:g,v=o.View,y=void 0===v?null:v,b=o.state,m=void 0===b?{}:b;u(this,t),this[e.immerable]=!0,this._id=n,this.title=r,this.order=i,this.data=f,this.parent=s,this.isComplete=p,this.canGoTo=h,this.View=y,this.state=m}return f(t,[{key:"id",get:function(){return this._id}},{key:"data",set:function(t){if(Array.isArray(t)){var e=new Map;t.forEach((function(t){return e.set(t.id,t)})),this._data=e}t instanceof Map&&(this._data=t)},get:function(){return this._data||(this._data=new Map),this._data}},{key:"isComplete",get:function(){if(null!==this._isComplete)return"function"==typeof this._isComplete?this._isComplete(this):this._isComplete;var t=!0;return this.data.forEach((function(e){t&&(e.hasValidValue||(t=!1))})),t},set:function(t){this._isComplete=t}},{key:"canGoTo",get:function(){return"function"==typeof this._canGoTo?this._canGoTo(this):this._canGoTo},set:function(t){this._canGoTo=t}}]),t}(),w=void 0,_=function(t){var e=t.pages;return n(y(e.values()),"order")},j=function(t){var e=_(t);return e?e.shift():null},S=function(t){var e=_(t);return e?e.pop():null},T=function(t){var e=t.currentPageId,n=t.pages,r=_(t).map((function(t){return t.id})),o=r.indexOf(e);return o<=0||o>=r.length?null:n.get(r[o-1])},I=function(t){var e=t.currentPageId,n=t.pages,r=_(t).map((function(t){return t.id})),o=r.indexOf(e);return o<0||o>=r.length-1?null:n.get(r[o+1])},E=function(t){return function(e,n){if(t){var r=t.pages.get(e);if(!r)return null;var o=r.data.get(n);return o?o.value:null}}},C=function(t){n(y(t.data.values()),"order").forEach((function(t,e){t.order=e}))},A=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e[0]instanceof O)return e[0];var r=h(O,e);return null===r.order&&(r.order=-1,w.pages.forEach((function(t){t.order>r.order&&(r.order=t.order)})),r.order+=1),C(r),r},D={addPage:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){var n=null;"function"==typeof e[e.length-1]&&(n=e.pop());var r=A.apply(void 0,e);C(r),t.pages.set(r.id,r),"function"==typeof n&&n(r)}},addPages:function(t){return function(e){var n=null;"function"==typeof t[_.length-1]&&(n=t.pop()),t.forEach((function(t){C(t),e.pages.set(t.id,t)})),"function"==typeof n&&n(t)}},addPageData:function(t,e){return function(n){var r=n.pages.get(t);if(r){var o=h(P,y(e));o.id&&r.data.set(o.id,o)}else console.log("cannot find a page",t)}},setDataValue:function(t,e,n){return function(r){var o=r.pages.get(t);if(o){var a=o.data.get(e);a&&(a.value=n)}}},goToPageId:function(t){return function(e){e.pages.has(t)?e.currentPageId=t:console.log("goToPageId: no page ",t)}},goFirst:function(){return function(t){var e=j(t);e?D.goToPageId(e.id)(t):console.log("goFirst: no first page")}},goLast:function(){return function(t){var e=S(t);e?D.goToPageId(e.id)(t):console.log("goLast: no last page")}},goNext:function(){return function(t){I(t);D.goToPage(I(t))(t)}},goPrev:function(){return function(t){D.goToPage(T(t))(t)}},goToPage:function(t){return function(e){t&&t.id&&e.pages.has(t.id)&&(e.currentPageId=t.id)}}},q=function(t,e){return D[e.action]?a(t,D[e.action].apply(D,y(e.args))):t};e.enableMapSet(),e.enableES5();var x={title:"wizard",pages:new Map,currentPageId:null,data:new Map};return{DataInput:function(e){var n=e.page,r=e.data,a=v(t.useState(r?r.value:""),2),u=a[0],c=a[1],f=t.useContext(i);if(t.useEffect((function(){var t=f.getDataValue(n.id,r.id);u!==t&&f.setDataValue(n.id,r.id,u)}),[u]),!n)return"";return o.createElement("input",{type:"text",value:u,onChange:function(t){c(t.target.value)}})},WizardContext:i,Wizard:function(e){var r=v(t.useReducer(q,a(x,(function(t){Object.keys(x).forEach((function(n){n in e&&(t[n]=e[n])}))}))),2),u=r[0],c=r[1],f=v(t.useState(Object.keys(D).reduce((function(t,e){return d(d({},t),{},l({},e,(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return c({action:e,args:n})})))}),{})),1)[0],s=v(t.useState(null),2),p=s[0],g=s[1],h=v(t.useState(null),2),b=h[0],m=h[1],P=v(t.useState(null),2),O=P[0],w=P[1],C=v(t.useState(null),2),A=C[0],k=C[1],G=v(t.useState(null),2),V=G[0],M=G[1],R=v(t.useState([]),2),z=R[0],F=R[1],L=v(t.useState([]),2),W=L[0],B=L[1];return t.useEffect((function(){k(j(u)),M(S(u))}),[z]),t.useEffect((function(){F(_(u)),B(function(t){for(var e=_(t).filter((function(t){return!1!==t.canGoTo})),r=new Set(e.filter((function(t){return!0===t.canGoTo}))),o=0,a=e[o];a&&(!0===a.canGoTo||a.isComplete);)r.add(a),a=e[o+=1];return e[o]&&r.add(e[o]),n(y(r),"order")}(u))}),[u.pages]),t.useEffect((function(){var t,e;g((e=(t=u).currentPageId,t.pages.get(e))),w(I(u)),m(T(u))}),[u.currentPageId,u.pages]),o.createElement(i.Provider,{value:d(d(d({},f),u),{},{state:u,actions:f,firstPage:A,lastPage:V,currentPage:p,pageList:z,prevPage:b,nextPage:O,pagesYouCanGoTo:W,getDataValue:E(u)})},e.children)},Data:P,Page:O}}));
