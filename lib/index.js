!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("react"),require("immer"),require("lodash.sortby"),require("lodash.flattendeep")):"function"==typeof define&&define.amd?define(["react","immer","lodash.sortby","lodash.flattendeep"],t):(e=e||self).MyRoot=t(e.React,e.produce,e.sortBy,e.flattenDeep)}(this,(function(e,t,n,r){"use strict";var a="default"in e?e.default:e,o="default"in t?t.default:t;n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;var i=a.createContext({wizard:!1});function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function h(e,t,n){return(h=p()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&g(a,n.prototype),a}).apply(null,arguments)}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}return n}(e,t)||P(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e){return function(e){if(Array.isArray(e))return b(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||P(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var m=function(){function e(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=o.hasValidValue,s=void 0===i?null:i,l=o.required,f=void 0!==l&&l,c=o.Input,d=void 0===c?null:c,g=o.order,p=void 0===g?null:g,h=o.errors,v=void 0===h?null:h,y=o.state,P=void 0===y?{}:y;u(this,e),this[t.immerable]=!0,this._id=n,this.label=r,this.order=p,this.value=a,this.errors=v,this.required=f,this.hasValidValue=s,this.Input=d,this.state=P}return l(e,[{key:"id",get:function(){return this._id}},{key:"errors",set:function(e){this._errors="string"==typeof e?[e]:e},get:function(){if("function"==typeof this._errors){var e=this._errors(this);return Array.isArray(e)?e:e?[e]:[]}return Array.isArray(this._errors)?y(this._errors):[]}},{key:"hasValidValue",get:function(){return!this.errors.length&&("function"==typeof this._hasValidValue?this._hasValidValue(this.value,this):!0===this._hasValidValue||!1===this._hasValidValue?this._hasValidValue:!this.required||""!==this.value)},set:function(e){this._hasValidValue=e}},{key:"required",get:function(){return"function"==typeof this._required?this._required(this):this._required},set:function(e){this._required=e}}]),e}(),_=function(){function e(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=a.order,i=void 0===o?null:o,s=a.data,l=void 0===s?[]:s,f=a.parent,c=void 0===f?null:f,d=a.isComplete,g=void 0===d?null:d,p=a.canGoTo,h=void 0===p?null:p,v=a.View,y=void 0===v?null:v,P=a.state,b=void 0===P?{}:P;u(this,e),this[t.immerable]=!0,this._id=n,this.title=r,this.order=i,this.data=l,this.parent=c,this.isComplete=g,this.canGoTo=h,this.View=y,this.state=b}return l(e,[{key:"_nextDataOrder",value:function(){var e=new Set;this.data.forEach((function(t){"number"==typeof t.order&&e.add(t.order)}));for(var t=0;e.has(t);)t+=1;return t}},{key:"_orderData",value:function(){var e=this;n(y(this._data.values()),"order").forEach((function(t){if("number"!=typeof t.order)try{t.order=e._nextDataOrder()}catch(e){console.error("cannot reorder ",t,"because",e)}}))}},{key:"id",get:function(){return this._id}},{key:"data",set:function(e){if(Array.isArray(e)){var t=new Map;e.forEach((function(e){return t.set(e.id,e)})),this._data=t}else e instanceof Map&&(this._data=e);this._orderData()},get:function(){return this._data||(this._data=new Map),this._data}},{key:"isComplete",get:function(){if(null!==this._isComplete)return"function"==typeof this._isComplete?this._isComplete(this):!!this._isComplete;var e=!0;return this.data.forEach((function(t){e&&t.required&&!t.hasValidValue&&(e=!1)})),e},set:function(e){this._isComplete=e}},{key:"canGoTo",get:function(){return"function"==typeof this._canGoTo?this._canGoTo(this):this._canGoTo},set:function(e){this._canGoTo=e}}]),e}(),O=void 0,w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Wizard action";return!(!e||"string"!=typeof e)||(console.log("bad field ",e,"submitted to ",t),!1)},S=function(){return"id"!==(arguments.length<=0?void 0:arguments[0])&&w.apply(void 0,arguments)},D=function(e){var t=e.pages;return n(y(t.values()),"order")},V=function(e){var t=D(e);return t?t.shift():null},j=function(e){var t=D(e);return t?t.pop():null},T=function(e){var t=e.currentPageId,n=e.pages,r=D(e).map((function(e){return e.id})),a=r.indexOf(t);return a<=0||a>=r.length?null:n.get(r[a-1])},I=function(e){var t=e.currentPageId,n=e.pages,r=D(e).map((function(e){return e.id})),a=r.indexOf(t);return a<0||a>=r.length-1?null:n.get(r[a+1])},A=function(e){return function(t,n){if(e){var r=e.pages.get(t);if(!r)return null;var a=r.data.get(n);return a?a.value:null}}},E=function(e,t,n){if(e instanceof _)return e;if(!("order"in n)){var r=-1;O.pages.forEach((function(e){e.order>r&&(r=e.order)})),r+=1,n=d(d({},n),{},{order:r})}return new _(e,t,n)},x={addPage:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){var n=null;"function"==typeof t[t.length-1]&&(n=t.pop());var r=E.apply(void 0,t);e.pages.set(r.id,r),"function"==typeof n&&n(r)}},addPages:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){var n=r(t),a=null;"function"==typeof n[D.length-1]&&(a=n.pop()),n.forEach((function(t){e.pages.set(t.id,t)})),"function"==typeof a&&a(n)}},addPageData:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return function(t){var r=t.pages.get(e);if(r){var a=n[0]instanceof m?m:h(m,n);a.id&&r.data.set(a.id,a)}else console.log("cannot find a page",e)}},setDataValue:function(e,t,n){return function(r){var a=r.pages.get(e);if(a){var o=a.data.get(t);o&&(o.value=n)}}},goToPageId:function(e){return function(t){t.pages.has(e)?t.currentPageId=e:console.log("goToPageId: no page ",e)}},goFirst:function(){return function(e){var t=V(e);t?x.goToPageId(t.id)(e):console.log("goFirst: no first page")}},goLast:function(){return function(e){var t=j(e);t?x.goToPageId(t.id)(e):console.log("goLast: no last page")}},goNext:function(e){return function(t){if(e){var n=function(e){var t=e.currentPageId,n=e.pages;if(!t)return null;var r=D(e).map((function(e){return e.id})),a=r.indexOf(t);if(a<0||a>=r.length-1)return null;for(var o=r.slice(a+1);o.length;){var i=o.shift();if(i!==t){var u=n.get(i);if(!1!==u.canGoTo)return u}}return null}(t);n&&x.goToPage(n)(t)}else x.goToPage(I(t))(t)}},goPrev:function(e){return function(t){if(e){var n=function(e){var t=e.currentPageId,n=e.pages;if(!t)return null;var r=D(e).map((function(e){return e.id})),a=r.indexOf(t);if(a<0||a>=r.length-1)return null;for(var o=r.slice(0,a);o.length;){var i=o.pop();if(i!==t){var u=n.get(i);if(!1!==u.canGoTo)return u}}return null}(t);n&&x.goToPage(n)(t)}else x.goToPage(T(t))(t)}},goToPage:function(e){return function(t){e&&e.id&&t.pages.has(e.id)&&(t.currentPageId=e.id)}},setPageProp:function(e,t,n){return function(r){if(S(t,"setPageProp"))if(r.pages.has(e)){var a=r.pages.get(e);t in a?a[t]=n:console.log("setPageProp - can only set existing fields of page ",a,"not ",t)}else console.log("setPagePoop: no page ",e)}},setPageStateField:function(e,t,n){return function(r){w(t,"setPageStateField")&&(r.pages.has(e)?r.pages.get(e).state[t]=n:console.log("setPageStateField: no page ",e))}},setPageDataProp:function(e,t,n,r){return function(a){if(S(n,"setPageDataProp"))if(a.pages.has(e)){var o=a.pages.get(e);if(o.data.has(t)){var i=o.data.get(t);n in i?i[n]=r:console.log("setPageDataProp: cannot assign new field ",n,"in ",i,"of",o)}else console.log("setPageDataProp: no data ",t,"in page",e)}else console.log("setPageDataProp: no page ",e)}},setPageDataStateField:function(e,t,n,r){return function(a){if(w(n,"setPageDataStateField"))if(a.pages.has(e)){var o=a.pages.get(e);if(o.data.has(t))o.data.get(t).state[n]=r;else console.log("setPageDataProp: no data ",t,"in page",e)}else console.log("setPageDataProp: no page ",e)}}},C=function(e,t){return x[t.action]?o(e,x[t.action].apply(x,y(t.args))):e};t.enableMapSet(),t.enableES5();var k={title:"wizard",pages:new Map,currentPageId:null,data:new Map};return{DataInput:function(t){var n=t.page,r=t.data,o=v(e.useState(r?r.value:""),2),u=o[0],s=o[1],l=e.useContext(i);if(e.useEffect((function(){var e=l.getDataValue(n.id,r.id);u!==e&&l.setDataValue(n.id,r.id,u)}),[u]),!n)return"";return a.createElement("input",{type:"text",value:u,onChange:function(e){s(e.target.value)}})},WizardContext:i,Wizard:function(t){var r=v(e.useReducer(C,o(k,(function(e){Object.keys(k).forEach((function(n){n in t&&(e[n]=t[n])}))}))),2),u=r[0],s=r[1],l=v(e.useState(function(e){return Object.keys(x).reduce((function(t,n){return d(d({},t),{},f({},n,(function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e({action:n,args:r})})))}),{})}(s)),1)[0],c=v(e.useState(null),2),g=c[0],p=c[1],h=v(e.useState(null),2),P=h[0],b=h[1],m=v(e.useState(null),2),_=m[0],O=m[1],w=v(e.useState(null),2),S=w[0],E=w[1],q=v(e.useState(null),2),G=q[0],F=q[1],M=v(e.useState([]),2),R=M[0],z=M[1],L=v(e.useState([]),2),W=L[0],B=L[1];return e.useEffect((function(){z(D(u)),B(function(e){for(var t=D(e).filter((function(e){return!1!==e.canGoTo})),r=new Set(t.filter((function(e){return!0===e.canGoTo}))),a=0,o=t[a];o&&(!0===o.canGoTo||o.isComplete);)r.add(o),o=t[a+=1];return t[a]&&r.add(t[a]),n(y(r),"order")}(u))}),[u.pages]),e.useEffect((function(){E(V(u)),F(j(u)),O(I(u)),b(T(u))}),[R]),e.useEffect((function(){var e,t;p((t=(e=u).currentPageId,e.pages.get(t)))}),[u.currentPageId,u.pages]),a.createElement(i.Provider,{value:d(d(d({},l),u),{},{actions:l,state:u,firstPage:S,lastPage:G,currentPage:g,pageList:R,prevPage:P,nextPage:_,pagesYouCanGoTo:W,getDataValue:A(u)})},t.children)},Data:m,Page:_}}));
