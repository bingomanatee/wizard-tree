Index: src/index.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import WizardContext from './WizardContext';\nimport Data from './Data';\nimport DataInput from './DataInput';\nimport Page from './Page';\nimport Wizard from './Wizard';\n\nexport default {\n  DataInput, WizardContext, Wizard, Data, Page,\n};\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- src/index.js	(revision d01bbaeaab37a9a6056d088ee81d09344f5f0e0c)
+++ src/index.js	(date 1604444945837)
@@ -2,7 +2,7 @@
 import Data from './Data';
 import DataInput from './DataInput';
 import Page from './Page';
-import Wizard from './Wizard';
+import Wizard from './WizardReducer';
 
 export default {
   DataInput, WizardContext, Wizard, Data, Page,
Index: .idea/rollup-react.iml
===================================================================
--- .idea/rollup-react.iml	(revision d01bbaeaab37a9a6056d088ee81d09344f5f0e0c)
+++ .idea/rollup-react.iml	(revision d01bbaeaab37a9a6056d088ee81d09344f5f0e0c)
@@ -1,12 +0,0 @@
-<?xml version="1.0" encoding="UTF-8"?>
-<module type="WEB_MODULE" version="4">
-  <component name="NewModuleRootManager">
-    <content url="file://$MODULE_DIR$">
-      <excludeFolder url="file://$MODULE_DIR$/.tmp" />
-      <excludeFolder url="file://$MODULE_DIR$/temp" />
-      <excludeFolder url="file://$MODULE_DIR$/tmp" />
-    </content>
-    <orderEntry type="inheritedJdk" />
-    <orderEntry type="sourceFolder" forTests="false" />
-  </component>
-</module>
\ No newline at end of file
Index: .idea/.gitignore
===================================================================
--- .idea/.gitignore	(revision d01bbaeaab37a9a6056d088ee81d09344f5f0e0c)
+++ .idea/.gitignore	(revision d01bbaeaab37a9a6056d088ee81d09344f5f0e0c)
@@ -1,5 +0,0 @@
-# Default ignored files
-/shelf/
-/workspace.xml
-# Editor-based HTTP Client requests
-/httpRequests/
Index: src/WizardReducer.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- src/WizardReducer.js	(date 1604444945833)
+++ src/WizardReducer.js	(date 1604444945833)
@@ -0,0 +1,81 @@
+/* eslint-disable no-console */
+import React, {
+  useState, useEffect, useReducer,
+} from 'react';
+
+import produce, { enableMapSet, enableES5 } from 'immer';
+import WizardContext from './WizardContext';
+import wizardReducer, {
+  currentPage, firstPage, lastPage, nextPage, pageList, prevPage, reducerActions, getDataValue, pagesYouCanGoTo,
+} from './actions';
+
+enableMapSet();
+enableES5();
+
+const INITIAL = {
+  title: 'wizard',
+  pages: new Map(),
+  currentPageId: null,
+  data: new Map(),
+};
+
+export default (props) => {
+  const [state, dispatch] = useReducer(wizardReducer, produce(INITIAL, (draft) => {
+    Object.keys(INITIAL).forEach((prop) => {
+      if (prop in props) {
+        draft[prop] = props[prop];
+      }
+    });
+  }));
+
+  const [actions] = useState(
+    // eslint-disable-next-line arrow-body-style
+    Object.keys(reducerActions).reduce((newActions, action) => {
+      return ({ ...newActions, [action]: (...args) => dispatch({ action, args }) });
+    }, {}),
+  );
+
+  const [current, setCurrent] = useState(null);
+  const [prev, setPrev] = useState(null);
+  const [next, setNext] = useState(null);
+  const [first, setFirst] = useState(null);
+  const [last, setLast] = useState(null);
+  const [list, setList] = useState([]);
+  const [youCanGoTo, setYouCanGoTo] = useState([]);
+
+  useEffect(() => {
+    setFirst(firstPage(state));
+    setLast(lastPage(state));
+  }, [list]);
+
+  useEffect(() => {
+    setList(pageList(state));
+    setYouCanGoTo(pagesYouCanGoTo(state));
+  }, [state.pages]);
+
+  useEffect(() => {
+    setCurrent(currentPage(state));
+    setNext(nextPage(state));
+    setPrev(prevPage(state));
+  }, [state.currentPageId, state.pages]);
+
+  return (
+    <WizardContext.Provider value={{
+      ...actions,
+      ...state,
+      state,
+      actions,
+      firstPage: first,
+      lastPage: last,
+      currentPage: current,
+      pageList: list,
+      prevPage: prev,
+      nextPage: next,
+      pagesYouCanGoTo: youCanGoTo,
+      getDataValue: getDataValue(state),
+    }}
+    >
+      {props.children}
+    </WizardContext.Provider>
+  );
+};
Index: src/actions.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- src/actions.js	(date 1604444945830)
+++ src/actions.js	(date 1604444945830)
@@ -0,0 +1,211 @@
+import produce from 'immer';
+import sortBy from 'lodash.sortby';
+import flattenDeep from 'lodash.flattendeep';
+import Data from './Data';
+import Page from './Page';
+
+export const pageList = ({ pages }) => sortBy([...pages.values()], 'order');
+
+export const currentPage = ({ currentPageId, pages }) => pages.get(currentPageId);
+
+export const firstPage = (state) => {
+  const list = pageList(state);
+  return list ? list.shift() : null;
+};
+
+export const lastPage = (state) => {
+  const list = pageList(state);
+  return list ? list.pop() : null;
+};
+
+export const prevPage = (state) => {
+  const { currentPageId, pages } = state;
+  const ids = pageList(state).map(({ id }) => id);
+  const index = ids.indexOf(currentPageId);
+  if ((index <= 0) || (index >= ids.length)) return null;
+  return pages.get(ids[index - 1]);
+};
+
+export const nextPage = (state) => {
+  const { currentPageId, pages } = state;
+  const ids = pageList(state).map(({ id }) => id);
+  const index = ids.indexOf(currentPageId);
+  if ((index < 0) || (index >= ids.length - 1)) return null;
+  return pages.get(ids[index + 1]);
+};
+
+/**
+ * returns a function that accesses a particular datum's value
+ *
+ * @param state
+ * @returns {function(*=, *=): (any|null)}
+ */
+export const getDataValue = (state) => (pageId, dataId) => {
+  if (!state) return undefined;
+
+  const page = state.pages.get(pageId);
+  if (!page) {
+    return null;
+  }
+  const data = page.data.get(dataId);
+  if (!data) {
+    return null;
+  }
+  return data.value;
+};
+
+const _orderPageControls = (page) => {
+  sortBy([...page.data.values()], 'order').forEach((data, order) => {
+    data.order = order;
+  });
+};
+
+const _makePage = (...args) => {
+  if (args[0] instanceof Page) return args[0];
+  const page = new Page(...args);
+
+  if (page.order === null) {
+    page.order = -1;
+    this.pages.forEach((otherPage) => {
+      if (otherPage.order > page.order) {
+        page.order = otherPage.order;
+      }
+    });
+    page.order += 1;
+  }
+  _orderPageControls(page);
+  return page;
+};
+
+/**
+ * this is a gnarly computation and you are more than welcome
+ * to not use it in your navigation.
+ *
+ * The theory is this:
+ * 1. exclude pages you cannot go to (canGoTo === false)
+ * 2. Add all the pages that have been manually targeted as reachable (canGoTo === true)
+ * 3. get a contiguous list of all the remaining complete pages -- from the first one
+ *    to the last complete page
+ * 4. Add the next page (done with page B, C is accessible)
+ *
+ * again - you might have a different navigation scheme in mind but this one
+ * is a sensible norm.
+ *
+ * @returns {Pages[]}
+ */
+export const pagesYouCanGoTo = (state) => {
+  // step 1: exclude unGoable
+  const list = pageList(state).filter((page) => page.canGoTo !== false);
+
+  const canNav = new Set(list.filter((p) => p.canGoTo === true));
+  // step 2: contiguous completed
+  let index = 0;
+  let page = list[index];
+  while (page && (page.canGoTo === true || page.isComplete)) {
+    canNav.add(page);
+    index += 1;
+    page = list[index];
+  }
+
+  // step 3: first next page
+  if (list[index]) {
+    canNav.add(list[index]);
+  }
+
+  // return as ordered array
+  return sortBy([...canNav], 'order');
+};
+
+export const reducerActions = {
+
+  addPage: (...args) => (state) => {
+    let cb = null;
+    if (typeof args[args.length - 1] === 'function') cb = args.pop();
+
+    const page = _makePage(...args);
+    _orderPageControls(page);
+    state.pages.set(page.id, page);
+    if (typeof cb === 'function') cb(page);
+  },
+
+  // note - addPages requires an array pf Page instances
+  addPages: (newPages) => (state) => {
+    let cb = null;
+    if (typeof newPages[pageList.length - 1] === 'function') cb = newPages.pop();
+    newPages.forEach((page) => {
+      _orderPageControls(page);
+      state.pages.set(page.id, page);
+    });
+    if (typeof cb === 'function') cb(newPages);
+  },
+
+  addPageData: (pageId, props) => (state) => {
+    const page = state.pages.get(pageId);
+    if (!page) {
+      console.log('cannot find a page', pageId);
+      return;
+    }
+    const data = new Data(...props);
+    if (data.id) {
+      page.data.set(data.id, data);
+    }
+  },
+
+  setDataValue: (pageId, dataId, value) => (state) => {
+    const page = state.pages.get(pageId);
+    if (!page) {
+      return;
+    }
+    const data = page.data.get(dataId);
+    if (!data) {
+      return;
+    }
+    data.value = value;
+  },
+
+  goToPageId: (pageId) => (state) => {
+    if (state.pages.has(pageId)) {
+      state.currentPageId = pageId;
+    } else {
+      console.log('goToPageId: no page ', pageId);
+    }
+  },
+
+  goFirst: () => (state) => {
+    const first = firstPage(state);
+    if (first) {
+      reducerActions.goToPageId(first.id)(state);
+    } else {
+      console.log('goFirst: no first page');
+    }
+  },
+
+  goLast: () => (state) => {
+    const last = lastPage(state);
+    if (last) {
+      reducerActions.goToPageId(last.id)(state);
+    } else {
+      console.log('goLast: no last page');
+    }
+  },
+
+  goNext: () => (state) => {
+    const next = nextPage(state);
+    reducerActions.goToPage(nextPage(state))(state);
+  },
+
+  goPrev: () => (state) => {
+    reducerActions.goToPage(prevPage(state))(state);
+  },
+
+  goToPage: (page) => (state) => {
+    if (page && page.id && state.pages.has(page.id)) {
+      state.currentPageId = page.id;
+    }
+  },
+};
+
+export default (state, action) => {
+  if (reducerActions[action.action]) return produce(state, reducerActions[action.action](...action.args));
+  return state;
+};
Index: .idea/misc.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"JavaScriptSettings\">\n    <option name=\"languageLevel\" value=\"JSX\" />\n  </component>\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- .idea/misc.xml	(revision d01bbaeaab37a9a6056d088ee81d09344f5f0e0c)
+++ .idea/misc.xml	(date 1604356623812)
@@ -3,4 +3,7 @@
   <component name="JavaScriptSettings">
     <option name="languageLevel" value="JSX" />
   </component>
+  <component name="ProjectRootManager" version="2" languageLevel="JDK_1_8" project-jdk-name="1.8" project-jdk-type="JavaSDK">
+    <output url="file://$PROJECT_DIR$/out" />
+  </component>
 </project>
\ No newline at end of file
Index: .idea/modules.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"ProjectModuleManager\">\n    <modules>\n      <module fileurl=\"file://$PROJECT_DIR$/.idea/rollup-react.iml\" filepath=\"$PROJECT_DIR$/.idea/rollup-react.iml\" />\n    </modules>\n  </component>\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- .idea/modules.xml	(revision d01bbaeaab37a9a6056d088ee81d09344f5f0e0c)
+++ .idea/modules.xml	(date 1604356623822)
@@ -2,7 +2,7 @@
 <project version="4">
   <component name="ProjectModuleManager">
     <modules>
-      <module fileurl="file://$PROJECT_DIR$/.idea/rollup-react.iml" filepath="$PROJECT_DIR$/.idea/rollup-react.iml" />
+      <module fileurl="file://$PROJECT_DIR$/.idea/react-wizard.iml" filepath="$PROJECT_DIR$/.idea/react-wizard.iml" />
     </modules>
   </component>
 </project>
\ No newline at end of file
Index: lib/index.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>!function(t,e){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=e(require(\"react\"),require(\"immer\"),require(\"lodash.sortby\")):\"function\"==typeof define&&define.amd?define([\"react\",\"immer\",\"lodash.sortby\"],e):(t=t||self).MyRoot=e(t.React,t.produce,t.sortBy)}(this,(function(t,e,n){\"use strict\";var r=\"default\"in t?t.default:t,a=\"default\"in e?e.default:e;n=n&&Object.prototype.hasOwnProperty.call(n,\"default\")?n.default:n;var o=r.createContext({wizard:!1});function i(t){return(i=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&\"function\"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?\"symbol\":typeof t})(t)}function u(t,e){if(!(t instanceof e))throw new TypeError(\"Cannot call a class as a function\")}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,\"value\"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function g(t,e,n){return(g=d()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var a=new(Function.bind.apply(t,r));return n&&f(a,n.prototype),a}).apply(null,arguments)}function p(t,e){return!e||\"object\"!=typeof e&&\"function\"!=typeof e?function(t){if(void 0===t)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return t}(t):e}function h(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(\"undefined\"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){a=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}return n}(t,e)||v(t,e)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if(\"undefined\"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||v(t)||function(){throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}()}function v(t,e){if(t){if(\"string\"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return\"Object\"===n&&t.constructor&&(n=t.constructor.name),\"Map\"===n||\"Set\"===n?Array.from(t):\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var P=function(){function t(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:\"\",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=o.validator,s=void 0!==i&&i,c=o.required,l=void 0!==c&&c,f=o.Input,d=void 0===f?null:f,g=o.state,p=void 0===g?{}:g;u(this,t),this[e.immerable]=!0,this._id=n,this.label=r,this.value=a,this.required=l,this.validator=\"function\"==typeof s&&s,this.Input=d,this.state=p}return c(t,[{key:\"id\",get:function(){return this._id}},{key:\"hasValidValue\",get:function(){return this.validator?this.validator(this.value,this):!this.required||\"\"!==this.value}},{key:\"required\",set:function(t){this._required=t},get:function(){return\"function\"==typeof this._required?this._required(this):this._required}}]),t}(),b=function(){function t(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=a.order,i=void 0===o?null:o,s=a.data,c=void 0===s?[]:s,l=a.parent,f=void 0===l?null:l,d=a.isComplete,g=void 0===d?null:d,p=a.canGoTo,h=void 0===p?null:p,y=a.View,v=void 0===y?null:y,m=a.state,P=void 0===m?{}:m;u(this,t),this[e.immerable]=!0,this._id=n,this.title=r,this.order=i,this.data=c,this.parent=f,this.isComplete=g,this.canGoTo=h,this.View=v,this.state=P}return c(t,[{key:\"id\",get:function(){return this._id}},{key:\"data\",set:function(t){if(Array.isArray(t)){var e=new Map;t.forEach((function(t){return e.set(t.id,t)})),this._data=e}t instanceof Map&&(this._data=t)},get:function(){return this._data||(this._data=new Map),this._data}},{key:\"isComplete\",get:function(){if(null!==this._isComplete)return\"function\"==typeof this._isComplete?this._isComplete(this):this._isComplete;var t=!0;return this.data.forEach((function(e){t&&(e.hasValidValue||(t=!1))})),t},set:function(t){this._isComplete=t}},{key:\"canGoTo\",get:function(){return\"function\"==typeof this._canGoTo?this._canGoTo(this):this._canGoTo},set:function(t){this._canGoTo=t}}]),t}();e.enableMapSet(),e.enableES5();var k={title:\"wizard\",pages:new Map,currentPageId:null,data:new Map},S=\"getPageState,setPageState,getDataState,setDataState,addPage,addPages,goNext,\".concat(\"addPageData,goToPageId,goPrev,setPages,getDataValue,setDataValue\".split(\",\")),_=\"pagesYouCanGoTo,firstPage,prevPage,nextPage,currentPage,pageList\".split(\",\"),w=function(t){!function(t,e){if(\"function\"!=typeof e&&null!==e)throw new TypeError(\"Super expression must either be null or a function\");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(v,t);var e,s,h=(e=v,s=d(),function(){var t,n=l(e);if(s){var r=l(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return p(this,t)});function v(t){var e;return u(this,v),(e=h.call(this,t)).state=a(k,(function(){})),e}return c(v,[{key:\"addPageData\",value:function(t){var e=this.pages.get(t);if(e){e=e.clone();for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var o=g(P,r);if(o.id){e.data.set(o.id,o);var i=this.pages;i.set(e.id,e),this.pages=i}}else console.log(\"cannot find a page\",t)}},{key:\"goToPageId\",value:function(t,e){if(t){var n=this.state.currentPageId;t!==this.state.currentPageId&&(console.log(\"going to \",t,\"from \",n),this.pages.has(t)?this.setState((function(e){return a(e,(function(e){e.currentPageId=t}))}),e):console.log(\"goToPageId: no id \",t))}}},{key:\"goFirst\",value:function(){var t=this.firstPage;t&&this.goToPageId(t.id)}},{key:\"goNext\",value:function(){var t=this.nextPage;t?this.goToPageId(t.id):console.log(\"cannot go to next page\")}},{key:\"goPrev\",value:function(){var t=this.prevPage;t?this.goToPageId(t.id):console.log(\"cannot go to prev page\")}},{key:\"setPages\",value:function(t,e){this.setState((function(e){return a(e,(function(e){e.pages=t}))}),e)}},{key:\"getDataValue\",value:function(t,e){var n=this.pages.get(t);if(!n)return null;var r=n.data.get(e);return r?r.value:null}},{key:\"setDataValue\",value:function(t,e,n,r){this.setState((function(r){return a(r,(function(r){var a=r.pages.get(t);if(!a)return r;var o=a.data.get(e);return o?(o.value=n,r):r}))}),r)}},{key:\"_makePage\",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e[0]instanceof b)return e[0];var r=g(b,e);if(r.id)return null===r.order&&(r.order=-1,this.pages.forEach((function(t){t.order>r.order&&(r.order=t.order)})),r.order+=1),r;console.log(\"cannot add page without id:\",r)}},{key:\"addPage\",value:function(){for(var t=null,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];\"function\"==typeof n[n.length-1]&&(t=n.pop());var o=this._makePage.apply(this,n);this.setState((function(t){return a(t,(function(t){t.pages.set(o.id,o)}))}),t)}},{key:\"addPages\",value:function(t,e){var n=this,r=this.state;t.forEach((function(t){var e=n._makePage(t);r=a(r,(function(t){t.pages.set(e.id,e)}))})),this.setState(r,e)}},{key:\"componentDidUpdate\",value:function(){var t=this.state,e=t.pages;!t.currentPageId&&e.size&&this.goFirst(!0)}},{key:\"updatePage\",value:function(t,e,n){e?this.setState((function(n){return a(n,(function(n){var r=n.pages.get(t);r?\"function\"==typeof e?n.pages.set(t,e(r)):\"object\"===i(e)&&n.pages.set(t,Object.assign(r,e)):console.log(\"updatePage: no page \",t,e)}))}),n):console.log(\"updatePage: no update\",t,e)}},{key:\"getPageState\",value:function(t,e){if(!t||!e)return console.log(\"getPageState requires pageId and stateName: given\",t,e),null;var n=this.pages.get(t);return n?n.state[e]:(console.log(\"cannot find page \",t),null)}},{key:\"setPageState\",value:function(t,e,n,r){return t&&e?this.updatePage(t,(function(t){t.state[e]=n}),r):(console.log(\"setPageState requires pageId and stateName: given\",t,e),null)}},{key:\"getDataState\",value:function(t,e,n){if(!e||!t||!n)return console.log(\"getDatatate requires pageId, dataId and stateName: given\",t,e,n),null;var r=this.pages.get(t);if(r){var a=r.data.get(e);if(a)return a.state[n]}return console.log(\"cannot find page data\",t,e),null}},{key:\"setDatatate\",value:function(t,e,n,r,a){return e&&t&&n?this.updatePage(t,(function(t){if(t){var a=t.data.get(e);a&&(a.state[n]=r)}}),a):(console.log(\"setDatatate requires pageId, dataId and stateName: given\",t,e,n),null)}},{key:\"render\",value:function(){return r.createElement(o.Provider,{value:this.proxy},this.props.children)}},{key:\"firstPage\",get:function(){var t=null;return this.pages.forEach((function(e){console.log(\"first\",t&&t.id,t&&t.order,\"page: \",e.id,e.order),t?t.order>e.order&&(t=e):t=e})),t}},{key:\"currentPage\",get:function(){var t=this.state,e=t.pages,n=t.currentPageId;return n?e.get(n):null}},{key:\"nextPage\",get:function(){var t=this.currentPage;if(!t)return null;var e=null;return this.state.pages.forEach((function(n){!1!==n.canGoTo&&(n.order<=t.order||(!e||e.order>n.order)&&(e=n))})),e}},{key:\"prevPage\",get:function(){var t=this.currentPage;if(!t)return null;var e=null;return this.state.pages.forEach((function(n){!1!==n.canGoTo&&(n.order>=t.order||(!e||e.order<n.order)&&(e=n))})),e}},{key:\"pages\",get:function(){return this.state.pages},set:function(t){this.setPages(t)}},{key:\"pageList\",get:function(){var t=this.pages,e=[];return t.forEach((function(t){return e.push(t)})),n(e,\"order\",\"id\")}},{key:\"pagesYouCanGoTo\",get:function(){for(var t=this.pageList.filter((function(t){return!1!==t.canGoTo})),e=new Set,r=0;t[r]&&t[r].isComplete;)e.add(t[r]),r+=1;return t[r]&&e.add(t[r]),t.forEach((function(t){!0===t.canGoTo&&e.add(t.canGoTo)})),n(y(e),\"order\")}},{key:\"proxy\",get:function(){var t=this;return\"undefined\"==typeof Proxy?(console.log(\"no proxy - returning immer\"),a(this.state,(function(e){_.forEach((function(n){e[n]=t[n]})),S.forEach((function(n){e[n]=function(){return t[n].apply(t,arguments)}}))}))):new Proxy(this,{get:function(t,e){return e in t.state?t.state[e]:S.includes(e)?t[e].bind(t):_.includes(e)?t[e]:null},has:function(t,e){return e in t.state||_.includes(e)||S.includes(e)},set:function(t,e,n){e in t.state?t.setState((function(t){return t[e]=n})):console.log(\"attempt to set read-only property\",e,\"to\",n)}})}}]),v}(t.Component);return{DataInput:function(e){var n=e.page,a=e.control,i=h(t.useState(a?a.value:\"\"),2),u=i[0],s=i[1],c=t.useContext(o);if(t.useEffect((function(){var t=c.getFormValue(n.id,a.id);u!==t&&c.setFormValue(n.id,a.id,u)}),[u]),!n)return\"\";return r.createElement(\"input\",{type:\"text\",value:u,onChange:function(t){s(t.target.value)}})},WizardContext:o,Wizard:w,Data:P,Page:b}}));\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- lib/index.js	(revision d01bbaeaab37a9a6056d088ee81d09344f5f0e0c)
+++ lib/index.js	(date 1604513778083)
@@ -1,1 +1,1 @@
-!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("react"),require("immer"),require("lodash.sortby")):"function"==typeof define&&define.amd?define(["react","immer","lodash.sortby"],e):(t=t||self).MyRoot=e(t.React,t.produce,t.sortBy)}(this,(function(t,e,n){"use strict";var r="default"in t?t.default:t,a="default"in e?e.default:e;n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;var o=r.createContext({wizard:!1});function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&s(t.prototype,e),n&&s(t,n),t}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function g(t,e,n){return(g=d()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var a=new(Function.bind.apply(t,r));return n&&f(a,n.prototype),a}).apply(null,arguments)}function p(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,u=t[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){a=!0,o=t}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}return n}(t,e)||v(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||v(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){if(t){if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var P=function(){function t(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=o.validator,s=void 0!==i&&i,c=o.required,l=void 0!==c&&c,f=o.Input,d=void 0===f?null:f,g=o.state,p=void 0===g?{}:g;u(this,t),this[e.immerable]=!0,this._id=n,this.label=r,this.value=a,this.required=l,this.validator="function"==typeof s&&s,this.Input=d,this.state=p}return c(t,[{key:"id",get:function(){return this._id}},{key:"hasValidValue",get:function(){return this.validator?this.validator(this.value,this):!this.required||""!==this.value}},{key:"required",set:function(t){this._required=t},get:function(){return"function"==typeof this._required?this._required(this):this._required}}]),t}(),b=function(){function t(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=a.order,i=void 0===o?null:o,s=a.data,c=void 0===s?[]:s,l=a.parent,f=void 0===l?null:l,d=a.isComplete,g=void 0===d?null:d,p=a.canGoTo,h=void 0===p?null:p,y=a.View,v=void 0===y?null:y,m=a.state,P=void 0===m?{}:m;u(this,t),this[e.immerable]=!0,this._id=n,this.title=r,this.order=i,this.data=c,this.parent=f,this.isComplete=g,this.canGoTo=h,this.View=v,this.state=P}return c(t,[{key:"id",get:function(){return this._id}},{key:"data",set:function(t){if(Array.isArray(t)){var e=new Map;t.forEach((function(t){return e.set(t.id,t)})),this._data=e}t instanceof Map&&(this._data=t)},get:function(){return this._data||(this._data=new Map),this._data}},{key:"isComplete",get:function(){if(null!==this._isComplete)return"function"==typeof this._isComplete?this._isComplete(this):this._isComplete;var t=!0;return this.data.forEach((function(e){t&&(e.hasValidValue||(t=!1))})),t},set:function(t){this._isComplete=t}},{key:"canGoTo",get:function(){return"function"==typeof this._canGoTo?this._canGoTo(this):this._canGoTo},set:function(t){this._canGoTo=t}}]),t}();e.enableMapSet(),e.enableES5();var k={title:"wizard",pages:new Map,currentPageId:null,data:new Map},S="getPageState,setPageState,getDataState,setDataState,addPage,addPages,goNext,".concat("addPageData,goToPageId,goPrev,setPages,getDataValue,setDataValue".split(",")),_="pagesYouCanGoTo,firstPage,prevPage,nextPage,currentPage,pageList".split(","),w=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(v,t);var e,s,h=(e=v,s=d(),function(){var t,n=l(e);if(s){var r=l(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return p(this,t)});function v(t){var e;return u(this,v),(e=h.call(this,t)).state=a(k,(function(){})),e}return c(v,[{key:"addPageData",value:function(t){var e=this.pages.get(t);if(e){e=e.clone();for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var o=g(P,r);if(o.id){e.data.set(o.id,o);var i=this.pages;i.set(e.id,e),this.pages=i}}else console.log("cannot find a page",t)}},{key:"goToPageId",value:function(t,e){if(t){var n=this.state.currentPageId;t!==this.state.currentPageId&&(console.log("going to ",t,"from ",n),this.pages.has(t)?this.setState((function(e){return a(e,(function(e){e.currentPageId=t}))}),e):console.log("goToPageId: no id ",t))}}},{key:"goFirst",value:function(){var t=this.firstPage;t&&this.goToPageId(t.id)}},{key:"goNext",value:function(){var t=this.nextPage;t?this.goToPageId(t.id):console.log("cannot go to next page")}},{key:"goPrev",value:function(){var t=this.prevPage;t?this.goToPageId(t.id):console.log("cannot go to prev page")}},{key:"setPages",value:function(t,e){this.setState((function(e){return a(e,(function(e){e.pages=t}))}),e)}},{key:"getDataValue",value:function(t,e){var n=this.pages.get(t);if(!n)return null;var r=n.data.get(e);return r?r.value:null}},{key:"setDataValue",value:function(t,e,n,r){this.setState((function(r){return a(r,(function(r){var a=r.pages.get(t);if(!a)return r;var o=a.data.get(e);return o?(o.value=n,r):r}))}),r)}},{key:"_makePage",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e[0]instanceof b)return e[0];var r=g(b,e);if(r.id)return null===r.order&&(r.order=-1,this.pages.forEach((function(t){t.order>r.order&&(r.order=t.order)})),r.order+=1),r;console.log("cannot add page without id:",r)}},{key:"addPage",value:function(){for(var t=null,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];"function"==typeof n[n.length-1]&&(t=n.pop());var o=this._makePage.apply(this,n);this.setState((function(t){return a(t,(function(t){t.pages.set(o.id,o)}))}),t)}},{key:"addPages",value:function(t,e){var n=this,r=this.state;t.forEach((function(t){var e=n._makePage(t);r=a(r,(function(t){t.pages.set(e.id,e)}))})),this.setState(r,e)}},{key:"componentDidUpdate",value:function(){var t=this.state,e=t.pages;!t.currentPageId&&e.size&&this.goFirst(!0)}},{key:"updatePage",value:function(t,e,n){e?this.setState((function(n){return a(n,(function(n){var r=n.pages.get(t);r?"function"==typeof e?n.pages.set(t,e(r)):"object"===i(e)&&n.pages.set(t,Object.assign(r,e)):console.log("updatePage: no page ",t,e)}))}),n):console.log("updatePage: no update",t,e)}},{key:"getPageState",value:function(t,e){if(!t||!e)return console.log("getPageState requires pageId and stateName: given",t,e),null;var n=this.pages.get(t);return n?n.state[e]:(console.log("cannot find page ",t),null)}},{key:"setPageState",value:function(t,e,n,r){return t&&e?this.updatePage(t,(function(t){t.state[e]=n}),r):(console.log("setPageState requires pageId and stateName: given",t,e),null)}},{key:"getDataState",value:function(t,e,n){if(!e||!t||!n)return console.log("getDatatate requires pageId, dataId and stateName: given",t,e,n),null;var r=this.pages.get(t);if(r){var a=r.data.get(e);if(a)return a.state[n]}return console.log("cannot find page data",t,e),null}},{key:"setDatatate",value:function(t,e,n,r,a){return e&&t&&n?this.updatePage(t,(function(t){if(t){var a=t.data.get(e);a&&(a.state[n]=r)}}),a):(console.log("setDatatate requires pageId, dataId and stateName: given",t,e,n),null)}},{key:"render",value:function(){return r.createElement(o.Provider,{value:this.proxy},this.props.children)}},{key:"firstPage",get:function(){var t=null;return this.pages.forEach((function(e){console.log("first",t&&t.id,t&&t.order,"page: ",e.id,e.order),t?t.order>e.order&&(t=e):t=e})),t}},{key:"currentPage",get:function(){var t=this.state,e=t.pages,n=t.currentPageId;return n?e.get(n):null}},{key:"nextPage",get:function(){var t=this.currentPage;if(!t)return null;var e=null;return this.state.pages.forEach((function(n){!1!==n.canGoTo&&(n.order<=t.order||(!e||e.order>n.order)&&(e=n))})),e}},{key:"prevPage",get:function(){var t=this.currentPage;if(!t)return null;var e=null;return this.state.pages.forEach((function(n){!1!==n.canGoTo&&(n.order>=t.order||(!e||e.order<n.order)&&(e=n))})),e}},{key:"pages",get:function(){return this.state.pages},set:function(t){this.setPages(t)}},{key:"pageList",get:function(){var t=this.pages,e=[];return t.forEach((function(t){return e.push(t)})),n(e,"order","id")}},{key:"pagesYouCanGoTo",get:function(){for(var t=this.pageList.filter((function(t){return!1!==t.canGoTo})),e=new Set,r=0;t[r]&&t[r].isComplete;)e.add(t[r]),r+=1;return t[r]&&e.add(t[r]),t.forEach((function(t){!0===t.canGoTo&&e.add(t.canGoTo)})),n(y(e),"order")}},{key:"proxy",get:function(){var t=this;return"undefined"==typeof Proxy?(console.log("no proxy - returning immer"),a(this.state,(function(e){_.forEach((function(n){e[n]=t[n]})),S.forEach((function(n){e[n]=function(){return t[n].apply(t,arguments)}}))}))):new Proxy(this,{get:function(t,e){return e in t.state?t.state[e]:S.includes(e)?t[e].bind(t):_.includes(e)?t[e]:null},has:function(t,e){return e in t.state||_.includes(e)||S.includes(e)},set:function(t,e,n){e in t.state?t.setState((function(t){return t[e]=n})):console.log("attempt to set read-only property",e,"to",n)}})}}]),v}(t.Component);return{DataInput:function(e){var n=e.page,a=e.control,i=h(t.useState(a?a.value:""),2),u=i[0],s=i[1],c=t.useContext(o);if(t.useEffect((function(){var t=c.getFormValue(n.id,a.id);u!==t&&c.setFormValue(n.id,a.id,u)}),[u]),!n)return"";return r.createElement("input",{type:"text",value:u,onChange:function(t){s(t.target.value)}})},WizardContext:o,Wizard:w,Data:P,Page:b}}));
+!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("react"),require("immer"),require("lodash.sortby"),require("lodash.flattendeep")):"function"==typeof define&&define.amd?define(["react","immer","lodash.sortby","lodash.flattendeep"],e):(t=t||self).MyRoot=e(t.React,t.produce,t.sortBy,t.lodash_flattendeep)}(this,(function(t,e,n,r){"use strict";var o="default"in t?t.default:t,a="default"in e?e.default:e;n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;var i=o.createContext({wizard:!1});function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),t}function l(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){l(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function h(t,e,n){return(h=g()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&p(o,n.prototype),o}).apply(null,arguments)}function v(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,a=void 0;try{for(var i,u=t[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(t){o=!0,a=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}return n}(t,e)||b(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||b(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){if(t){if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var P=function(){function t(n,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=a.validator,c=void 0!==i&&i,f=a.required,l=void 0!==f&&f,s=a.Input,d=void 0===s?null:s,p=a.order,g=void 0===p?null:p,h=a.state,v=void 0===h?{}:h;u(this,t),this[e.immerable]=!0,this._id=n,this.label=r,this.order=g,this.value=o,this.required=l,this.validator="function"==typeof c&&c,this.Input=d,this.state=v}return f(t,[{key:"id",get:function(){return this._id}},{key:"hasValidValue",get:function(){return this.validator?this.validator(this.value,this):!this.required||""!==this.value}},{key:"required",set:function(t){this._required=t},get:function(){return"function"==typeof this._required?this._required(this):this._required}}]),t}(),O=function(){function t(n,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=o.order,i=void 0===a?null:a,c=o.data,f=void 0===c?[]:c,l=o.parent,s=void 0===l?null:l,d=o.isComplete,p=void 0===d?null:d,g=o.canGoTo,h=void 0===g?null:g,v=o.View,y=void 0===v?null:v,b=o.state,m=void 0===b?{}:b;u(this,t),this[e.immerable]=!0,this._id=n,this.title=r,this.order=i,this.data=f,this.parent=s,this.isComplete=p,this.canGoTo=h,this.View=y,this.state=m}return f(t,[{key:"id",get:function(){return this._id}},{key:"data",set:function(t){if(Array.isArray(t)){var e=new Map;t.forEach((function(t){return e.set(t.id,t)})),this._data=e}t instanceof Map&&(this._data=t)},get:function(){return this._data||(this._data=new Map),this._data}},{key:"isComplete",get:function(){if(null!==this._isComplete)return"function"==typeof this._isComplete?this._isComplete(this):this._isComplete;var t=!0;return this.data.forEach((function(e){t&&(e.hasValidValue||(t=!1))})),t},set:function(t){this._isComplete=t}},{key:"canGoTo",get:function(){return"function"==typeof this._canGoTo?this._canGoTo(this):this._canGoTo},set:function(t){this._canGoTo=t}}]),t}(),w=void 0,_=function(t){var e=t.pages;return n(y(e.values()),"order")},j=function(t){var e=_(t);return e?e.shift():null},S=function(t){var e=_(t);return e?e.pop():null},T=function(t){var e=t.currentPageId,n=t.pages,r=_(t).map((function(t){return t.id})),o=r.indexOf(e);return o<=0||o>=r.length?null:n.get(r[o-1])},I=function(t){var e=t.currentPageId,n=t.pages,r=_(t).map((function(t){return t.id})),o=r.indexOf(e);return o<0||o>=r.length-1?null:n.get(r[o+1])},E=function(t){return function(e,n){if(t){var r=t.pages.get(e);if(!r)return null;var o=r.data.get(n);return o?o.value:null}}},C=function(t){n(y(t.data.values()),"order").forEach((function(t,e){t.order=e}))},A=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e[0]instanceof O)return e[0];var r=h(O,e);return null===r.order&&(r.order=-1,w.pages.forEach((function(t){t.order>r.order&&(r.order=t.order)})),r.order+=1),C(r),r},D={addPage:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){var n=null;"function"==typeof e[e.length-1]&&(n=e.pop());var r=A.apply(void 0,e);C(r),t.pages.set(r.id,r),"function"==typeof n&&n(r)}},addPages:function(t){return function(e){var n=null;"function"==typeof t[_.length-1]&&(n=t.pop()),t.forEach((function(t){C(t),e.pages.set(t.id,t)})),"function"==typeof n&&n(t)}},addPageData:function(t,e){return function(n){var r=n.pages.get(t);if(r){var o=h(P,y(e));o.id&&r.data.set(o.id,o)}else console.log("cannot find a page",t)}},setDataValue:function(t,e,n){return function(r){var o=r.pages.get(t);if(o){var a=o.data.get(e);a&&(a.value=n)}}},goToPageId:function(t){return function(e){e.pages.has(t)?e.currentPageId=t:console.log("goToPageId: no page ",t)}},goFirst:function(){return function(t){var e=j(t);e?D.goToPageId(e.id)(t):console.log("goFirst: no first page")}},goLast:function(){return function(t){var e=S(t);e?D.goToPageId(e.id)(t):console.log("goLast: no last page")}},goNext:function(){return function(t){I(t);D.goToPage(I(t))(t)}},goPrev:function(){return function(t){D.goToPage(T(t))(t)}},goToPage:function(t){return function(e){t&&t.id&&e.pages.has(t.id)&&(e.currentPageId=t.id)}}},q=function(t,e){return D[e.action]?a(t,D[e.action].apply(D,y(e.args))):t};e.enableMapSet(),e.enableES5();var x={title:"wizard",pages:new Map,currentPageId:null,data:new Map};return{DataInput:function(e){var n=e.page,r=e.data,a=v(t.useState(r?r.value:""),2),u=a[0],c=a[1],f=t.useContext(i);if(t.useEffect((function(){var t=f.getDataValue(n.id,r.id);u!==t&&f.setDataValue(n.id,r.id,u)}),[u]),!n)return"";return o.createElement("input",{type:"text",value:u,onChange:function(t){c(t.target.value)}})},WizardContext:i,Wizard:function(e){var r=v(t.useReducer(q,a(x,(function(t){Object.keys(x).forEach((function(n){n in e&&(t[n]=e[n])}))}))),2),u=r[0],c=r[1],f=v(t.useState(Object.keys(D).reduce((function(t,e){return d(d({},t),{},l({},e,(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return c({action:e,args:n})})))}),{})),1)[0],s=v(t.useState(null),2),p=s[0],g=s[1],h=v(t.useState(null),2),b=h[0],m=h[1],P=v(t.useState(null),2),O=P[0],w=P[1],C=v(t.useState(null),2),A=C[0],k=C[1],G=v(t.useState(null),2),V=G[0],M=G[1],R=v(t.useState([]),2),z=R[0],F=R[1],L=v(t.useState([]),2),W=L[0],B=L[1];return t.useEffect((function(){k(j(u)),M(S(u))}),[z]),t.useEffect((function(){F(_(u)),B(function(t){for(var e=_(t).filter((function(t){return!1!==t.canGoTo})),r=new Set(e.filter((function(t){return!0===t.canGoTo}))),o=0,a=e[o];a&&(!0===a.canGoTo||a.isComplete);)r.add(a),a=e[o+=1];return e[o]&&r.add(e[o]),n(y(r),"order")}(u))}),[u.pages]),t.useEffect((function(){var t,e;g((e=(t=u).currentPageId,t.pages.get(e))),w(I(u)),m(T(u))}),[u.currentPageId,u.pages]),o.createElement(i.Provider,{value:d(d(d({},f),u),{},{state:u,actions:f,firstPage:A,lastPage:V,currentPage:p,pageList:z,prevPage:b,nextPage:O,pagesYouCanGoTo:W,getDataValue:E(u)})},e.children)},Data:P,Page:O}}));
Index: package.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>{\n  \"name\": \"@wonderlandlabs/react-wizard\",\n  \"version\": \"0.0.4\",\n  \"description\": \"A starter for making a react component\",\n  \"main\": \"lib/index.js\",\n  \"module\": \"es/index.js\",\n  \"files\": [\n    \"es\",\n    \"lib\",\n    \"umd\"\n  ],\n  \"scripts\": {\n    \"testb\": \"yarn build; tap test test/* -R=base\",\n    \"testbo\": \"yarn build;TAP_ONLY=1 tap test test/* -R=base\",\n    \"test\": \"tap test test/* -R=base\",\n    \"testo\": \"TAP_ONLY=1 tap test test/* -R=base\",\n    \"build\": \"node_modules/rollup/dist/bin/rollup -c='rollup.config.js'\",\n    \"build-doc\": \"node ./documentation.js\",\n    \"doc\": \"gitdocs serve\"\n  },\n  \"dependencies\": {\n    \"immer\": \"7.0.14\",\n    \"lodash.isequal\": \"^4.5.0\",\n    \"lodash.sortby\": \"4.7.0\",\n    \"prop-types\": \"^15.7.2\"\n  },\n  \"peerDependencies\": {\n    \"react\": \"^17.0.0\",\n    \"react-dom\": \"17.0.0\",\n    \"styled-components\": \"^5.2.0\"\n  },\n  \"devDependencies\": {\n    \"@babel/plugin-proposal-class-properties\": \"^7.12.1\",\n    \"@rollup/plugin-commonjs\": \"^15.0.0\",\n    \"@rollup/plugin-node-resolve\": \"^9.0.0\",\n    \"babel-eslint\": \"^10.0.3\",\n    \"documentation\": \"^13.0.2\",\n    \"eslint\": \"^6.3.0\",\n    \"eslint-config-airbnb\": \"^18.0.1\",\n    \"eslint-plugin-import\": \"^2.18.2\",\n    \"eslint-plugin-jsx-a11y\": \"^6.2.3\",\n    \"eslint-plugin-react\": \"^7.14.3\",\n    \"eslint-plugin-react-hooks\": \"^2.1.1\",\n    \"gitdocs\": \"^2.0.0\",\n    \"react-is\": \"^17.0.0\",\n    \"rollup\": \"^1.22.0\",\n    \"rollup-plugin-babel\": \"^4.4.0\",\n    \"rollup-plugin-bundle-size\": \"^1.0.3\",\n    \"rollup-plugin-commonjs\": \"^10.1.0\",\n    \"rollup-plugin-node-resolve\": \"^5.2.0\",\n    \"rollup-plugin-terser\": \"^7.0.1\",\n    \"stream-array\": \"^1.1.2\",\n    \"tap\": \"^14.10.7\",\n    \"vinyl-fs\": \"^3.0.3\"\n  },\n  \"author\": \"Your Name Here\",\n  \"license\": \"MIT\",\n  \"repository\": \"https://github.com/mygithubhandle/react-picker\"\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- package.json	(revision d01bbaeaab37a9a6056d088ee81d09344f5f0e0c)
+++ package.json	(date 1604435003211)
@@ -20,6 +20,7 @@
   },
   "dependencies": {
     "immer": "7.0.14",
+    "lodash.flattendeep": "^4.4.0",
     "lodash.isequal": "^4.5.0",
     "lodash.sortby": "4.7.0",
     "prop-types": "^15.7.2"
